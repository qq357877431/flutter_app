version: '3.8'

services:
  backend:
    image: golang:1.21-alpine
    container_name: daily_planner_backend
    restart: always
    working_dir: /app
    environment:
      GOPROXY: https://goproxy.cn,direct
      DB_HOST: 127.0.0.1
      DB_PORT: 3306
      DB_USER: planner
      DB_PASSWORD: nagenanren123
      DB_NAME: daily_planner
      JWT_SECRET: your-super-secret-jwt-key-2024
      SERVER_PORT: 8080
    network_mode: host
    command: sh -c "cd /app && go mod tidy && go run ./cmd/main.go"
    volumes:
      - /opt/flutter_app/backend:/app

  admin-dashboard:
    build:
      context: ./admin-dashboard
      dockerfile: Dockerfile
    container_name: daily_planner_admin
    restart: always
    network_mode: host
    depends_on:
      - backend
